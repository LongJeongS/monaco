{"version":3,"sources":["monaco.js"],"names":["root","factory","define","amd","exports","module","require","Monaco","_","Backbone","localStorage","this","App","Application","appName","options","Error","name","cid","uniqueId","_settings","models","collections","views","RouterClass","Router","router","app","routes","trigger","extend","prototype","Events","start","pushState","has","_addRoutes","history","add","className","object","namespace","_app","get","key","result","JSON","parse","getItem","e","set","value","persist","setItem","stringify","fetchError","error","obj","resp","apply","arguments","_collectionFetch","call","Collection","fetch","_modelFetch","Model","View","_uroutes","_routes","constructor","length","initialize","each","route","push","routeList","isObject","keys","pop","unshift","_addRoute","callback","isString","isArray","History","optionalParam","namedParam","splatParam","escapeRegExp","_routeConstraints","routeKey","find","regexp","_routeToRegExp","constraints","replace","match","optional","substr","reStr","toString","slice","lastIndexOf","RegExp","filter","filters","controller","next","i","l","_wrapFilter","_filters","bind","addFilter","_getByName","possibleRoutes","map","compact","reverse","params","url","template","children","_subviewConstructor","render","_subviewsRender","remove","_subviewsRemove","data","collection","toJSON","model","$el","append","view","selector","ViewClass","viewClass","collectionItem","_subviewPerModelConstructor","parent","suffix","addOne","args","Array","itemView","listWrapper","context","ViewForModels","addAll","listenTo","viewParams","clone","_arguments","autoRender","el","stopListening","info","fromAddAll","content","keepValues","on","local","autoCache","Boolean","cacheExpire","isNull","isNumber","prefetched","resource","expire","applicationAdd","Class","isCollection","_getLocalData","decompress","item","idAttribute","id","_ts","_isExpired","modelExpire","_setExpire","_addToCollectionData","compress","_storageSet","_memorySet","clear","_clearItem","_clearAll","localData","caching","j","restfulData","collectionData","reset","silent","merge","revertParse","_memoryGet","_memory","_storageGet","_getKey","undefined","newKeys","exception","asProperty","timestamp","date","Date","setMinutes","getMinutes","getTime","now","removeItem","split","collectionInitialize","fromLocal","modelInitialize","sync","method","localOnly","fresh","success","cacheLocal","customCachePolicy","cachePolicy","status","xhr","getResponseHeader","parseInt","loadUrl","self","matched","pvFragment","fragment","test","trackPageview","ga","experiments","Experiments","_experiments","slot","scope","cookie","prefix","days","baseDomain","experiment","groups","Experiment","optout","users","usersPerGroup","Math","floor","size","normalized","_normalizeGroup","utils","setCookie","getCookie","original","current","cookieOpt","groupKey","random","saveGroup","methodName","_gaq","group","count","hasOwnProperty","remaining","transitions","transitionTo","targetView","Transition","currentView","TransitionClass","DefaultTransition","transition","fromView","toView"],"mappings":"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","file":"monaco.min.js","sourcesContent":["(function(root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define(['lodash', 'backbone', 'storage'], factory);\n  } else if (typeof exports === 'object') {\n    module.exports = factory(require('lodash'), require('backbone'), require('storage'));\n  } else {\n    root.Monaco = factory(root._, root.Backbone, root.localStorage);\n  }\n}(this, function(_, Backbone, localStorage) {\n/*\n * Creates the Application monaco class, used to instantiate monaco applications\n */\n\n// make sure monaco is defined as the main object\nvar Monaco = this.Monaco = (this.Monaco || {});\n\n/* -- APPLICATION ------------------------------------------------------ */\nvar App = Monaco.Application = function(appName, options) {\n  if (!appName) {\n    throw new Error('Monaco :: missing required application parameter: appName');\n  }\n\n  options = options || {};\n\n  // Application Unique Name\n  this.name = appName;\n  this.options = options;\n\n  // Application Client Id\n  this.cid = _.uniqueId('app');\n\n  this._settings      = {}; // used internally to store app settings ( get/set )\n  this.models         = {}; // initialize model namespace\n  this.collections    = {}; // initialize collection namespace\n  this.views          = {}; // initialize view namespace\n\n  // create a router instance\n  var RouterClass = options.RouterClass || Monaco.Router;\n  this.router = new RouterClass({app: this, routes: options.routes});\n\n  // trigger a global event for application module setup\n  Monaco.trigger('app:built', this, options);\n};\n\n_.extend(App.prototype, Backbone.Events, {\n  // Start the Monaco application\n  start : function(options) {\n    options = options || {};\n    options.pushState = options.pushState || false;\n\n    // when starting the application an instance of a router should exist\n    if (!_.has(this, 'router')) {\n      throw new Error('Monaco :: missing required router instance before starting the application');\n    }\n\n    // Add all unregistered routes before starting the history\n    this.router._addRoutes();\n\n    Monaco.history.start(options);\n\n    // trigger a global event for application module setup\n    Monaco.trigger('app:initialized', this, options);\n  },\n\n  // Interface used to add objects (models, collections, views and transitions) to your application\n  add : function(className, object) {\n\n    // all objects added through this method needs a namespace\n    if (!object.prototype || !object.prototype.namespace) {\n      throw new Error('Monaco :: missing required object property \\'namespace\\'');\n    }\n\n    // fail on duplicated objects being created on the same namespace\n    if (this[object.prototype.namespace][className]) {\n      throw new Error('Monaco :: ' + className + ' have already been defined in ' + this.name + '.' + object.prototype.namespace);\n    }\n\n    // injects the app reference in the object prototype\n    object.prototype._app = this;\n\n    // adds the object using the proper namespacing\n    this[object.prototype.namespace][className] = object;\n  },\n\n  // App setting get method, returning undefined if not found or any error occurs\n  // todo: return null instead of undefined to comply with the localStorage api\n  get : function(key) {\n    // searchs for the key in memory\n    if (_.has(this._settings, key)) {\n      return this._settings[key];\n    }\n\n    // searchs for the key in local storage\n    var result = null;\n    try {\n      result = JSON.parse(localStorage.getItem(key));\n    } catch( e ) {\n      return void 0;\n    }\n\n    if (result === null) {\n      return void 0;\n    }\n\n    // store the key/value in memory\n    this._settings[key] = result;\n\n    // return the value\n    return result;\n  },\n\n  // App setting set method\n  set : function(key, value, persist) {\n    persist = persist || false;\n    // validation\n    if (key === void 0 || value === void 0) {\n      throw new Error('set method required both key and value parameters { key: ' + key + ' | value: ' + value + ' }');\n    }\n\n    // store the key/value in memory\n    this._settings[key] = value;\n\n    // if persist is set to true then store the key/value in localStorage\n    if (persist === true) {\n      try {\n        localStorage.setItem(key, JSON.stringify(value));\n      } catch(e) {\n        // console.log( 'Warning: fail to persist key: ' + key );\n        return false;\n      }\n    }\n    return true;\n   }\n});\n\n// Allow the `Monaco` object to serve as a global event bus\n_.extend(Monaco, Backbone.Events);\n\n// wraps the error callback to trigger the proper events\nvar fetchError = function(options) {\n  options = options || {};\n\n  var error = options.error,\n      router = ( this._app & this._app.router ) ? this._app.router : null;\n\n  // custom error method that will trigger a custom event before executing\n  // the error callback\n  options.error = function(obj, resp, options) {\n    if (router) {\n      router.trigger('route:fetch.error', obj, resp, options);\n    }\n    if (error) {\n      error.apply(this, arguments);\n    }\n  };\n  return options;\n};\n\n/* -- COLLECTION ------------------------------------------------------- */\n// override the fetch method to add the default error router\nvar _collectionFetch = function(options) {\n  options = fetchError.call(this, options);\n  return Backbone.Collection.prototype.fetch.call(this, options);\n};\n\ntry {\n  Monaco.Collection = Backbone.Collection.extend({\n    // application collection namespace\n    namespace : 'collections',\n\n    // override the fetch method to add the default error router\n    fetch : _collectionFetch\n  });\n}\ncatch(e) {\n  // this addresses an issue with some versions of google browser - better described\n  // by this ticket on backbone: https://github.com/jashkenas/backbone/issues/1475\n  // and this ticket on chrome forum: https://code.google.com/p/chromium/issues/detail?id=136380\n  // sample of user agent where the problem was observed:\n  //\n  // Mozilla/5.0 (Linux; U; Android 4.1.1; tr-tr; Build/JRO03C) AppleWebKit/534.30 (KHTML, like Gecko) Version/4.0 Safari/534.30\n  // Mozilla/5.0 (Linux; U; Android 4.0.4; en-us; Next7P12-8G Build/IMM76I) AppleWebKit/534.30 (KHTML, like Gecko) Version/4.0 Safari/534.30\n  //\n  // Note that not all Android 4.1.1 or Android 4.0.4 triggered the same misbehaviour\n  Monaco.Collection = Backbone.Collection;\n  Monaco.Collection.prototype.namespace = 'collections';\n  Monaco.Collection.prototype.fetch = _collectionFetch;\n}\n\n    /* -- MODEL ------------------------------------------------------------ */\nvar _modelFetch = function(options) {\n  options = fetchError.call(this, options);\n  return Backbone.Model.prototype.fetch.call(this, options);\n};\n\ntry {\n  Monaco.Model = Backbone.Model.extend({\n    // application model namespace\n    namespace : 'models',\n\n    // override the fetch method to add the default error router\n    fetch : _modelFetch\n  });\n}\ncatch(e) {\n  // this addresses an issue with some versions of google browser - better described\n  // by this ticket on backbone: https://github.com/jashkenas/backbone/issues/1475\n  // and this ticket on chrome forum: https://code.google.com/p/chromium/issues/detail?id=136380\n  // sample of user agent where the problem was observed:\n  //\n  // Mozilla/5.0 (Linux; U; Android 4.1.1; tr-tr; Build/JRO03C) AppleWebKit/534.30 (KHTML, like Gecko) Version/4.0 Safari/534.30\n  // Mozilla/5.0 (Linux; U; Android 4.0.4; en-us; Next7P12-8G Build/IMM76I) AppleWebKit/534.30 (KHTML, like Gecko) Version/4.0 Safari/534.30\n  //\n  // Note that not all Android 4.1.1 or Android 4.0.4 triggered the same misbehaviour\n\n  Monaco.Model = Backbone.Model;\n  Monaco.Model.prototype.namespace = 'models';\n  Monaco.Model.prototype.fetch = _modelFetch;\n}\n\n/* -- VIEW ------------------------------------------------------------- */\nMonaco.View = Backbone.View.extend({\n  // application view namespace\n  namespace : 'views'\n});\n\n/* -- ROUTER ----------------------------------------------------------- */\nMonaco.Router = Backbone.Router.extend({\n  // undefined routes\n  _uroutes : [],\n\n  // defined routes\n  _routes : [],\n\n  // override the Backbone Router constructor\n  constructor : function(options) {\n    this.app = arguments.length > 0 ? arguments[0].app : void 0;\n    var initialize = this.initialize; // keep the original initialize method\n    // wrap the initialize method to store each route definition\n    this.initialize = function(options) {\n      _.each(options.routes, function(options, route) {\n        this._routes.push({key: route, value: options});\n      }, this);\n      initialize.apply(this, arguments);\n    };\n    Backbone.Router.prototype.constructor.apply(this, arguments);\n  },\n\n  // stores routes that will be added when the application starts\n  add : function(routes) {\n    var route, routeList;\n    if (!routes || !_.isObject(routes)) {\n      throw new Error('invalid routes format - please check the docs');\n    }\n    routeList = _.keys(routes);\n\n    while ((route = routeList.pop())) {\n      this._uroutes.unshift({key: route, value: routes[route]});\n    }\n  },\n\n  // adds all undefined routes into Backbone.Router\n  _addRoutes : function() {\n    var route;\n    while((route = this._uroutes.pop())) {\n      // this needs to be added to the _route list before the route gets added to the Router.\n      this._routes.push(route);\n      this._addRoute(route.key, route.value);\n    }\n  },\n\n  // adds one route into Backbone.Router\n  _addRoute : function(route, options) {\n    options = options || {};\n\n    if (route !== '' && !route) {\n      throw new Error('invalid route: ' + route);\n    }\n\n    var callback = null;\n        // name = null; // todo: verify if it should be null or empty string\n\n    if (_.isString(options)) {\n      callback = options;\n    }\n    else if (_.isArray(options) && options.length > 0) {\n      callback = options[0];\n      // todo: I don't think we need to care about the name in this method,\n      //       since Backbone uses the name just to point to a router instance callback method\n      // if ((options.length > 1) && _.isString(options[1])) {\n      //     name = options[1];\n      // } else if (options.length > 1 && _.isObject(options[1])) {\n      //     name = options[1].name;\n      // }\n    }\n\n    if (!callback) {\n      throw new Error('invalid callback from route: ' + route);\n    }\n\n    return this.route(route, callback);\n    // return this.route(route, name, callback);\n  }\n});\n\n/* -- HISTORY ----------------------------------------------------------- */\nMonaco.History = Backbone.History;\n\n// Creates a reference to Backbone history instance in Monaco\nMonaco.history = Backbone.history;\n\nreturn Monaco;\n}));\n\n(function(root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define(['lodash', 'backbone', 'storage'], factory);\n  } else if (typeof exports === 'object') {\n    module.exports = factory(require('lodash'), require('backbone'), require('storage'));\n  } else {\n    root.Monaco = factory(root._, root.Backbone, root.localStorage);\n  }\n}(this, function(_, Backbone, localStorage) {\n/*\n * Creates the Router monaco class to facilitate application routing\n */\n\n// make sure monaco is defined as the main object\nvar Monaco = this.Monaco = (this.Monaco || {});\n\n/* -- ROUTER ----------------------------------------------------------- */\n// Cached regular expressions for matching named param parts and splatted\n// parts of route strings.\nvar optionalParam = /\\((.*?)\\)/g;\nvar namedParam    = /(\\(\\?)?:\\w+/g;\nvar splatParam    = /\\*\\w+/g;\nvar escapeRegExp  = /[\\-{}\\[\\]+?.,\\\\\\^$|#\\s]/g;\n\n// return the regexp option of the specific router if available\n// otherwise undefined will be returned\nMonaco.Router.prototype._routeConstraints = function(routeKey) {\n  // var value = this._routes[route];\n  var route = _.find(this._routes, function(route) {\n    return route.key === routeKey;\n  });\n  if (route && route.value && _.isArray(route.value) && route.value.length > 1 && _.isObject(route.value[1])) {\n    return route.value[1].regexp;\n  }\n  return void 0;\n};\n\n// override the original Backbone method to deal with the regex constraints\nMonaco.Router.prototype._routeToRegExp = function(route) {\n  var constraints = this._routeConstraints(route);\n  route = route.replace(escapeRegExp, '\\\\$&')\n               .replace(optionalParam, '(?:$1)?')\n               .replace(namedParam, function(match, optional){\n                  // this `if` is the only difference from the original method from Backbone\n                  if (constraints && constraints[match.substr(1)]) {\n                    var reStr = constraints[match.substr(1)].toString();\n                    return '(' + reStr.slice(1, reStr.lastIndexOf('/')) + ')';\n                  }\n                  return optional ? match : '([^\\/]+)';\n               })\n               .replace(splatParam, '(.*?)');\n  return new RegExp('^' + route + '$');\n};\n\nMonaco.Router.prototype.filter = function(filters, controller) {\n  var next;\n  for (var i = (filters.length - 1) , l = 0; i >= l; i-- ) {\n    next = controller;\n    controller = this._wrapFilter(filters[i], next);\n  }\n\n  return controller;\n};\n\n// internal list of filters\nMonaco.Router.prototype._filters = {};\n\nMonaco.Router.prototype._wrapFilter = function(filter, next) {\n  return _.bind(function() {\n    this._filters[filter].call(this, next, arguments);\n  }, this);\n};\n\n// adds a filter method to list of filters\nMonaco.Router.prototype.addFilter = function(name, callback) {\n  if (this._filters[name]) {\n    throw new Error('Monaco :: filter already exists: ' + name);\n  }\n  this._filters[name] = callback;\n};\n\n// returns the original route definition based on the url name informed\nMonaco.Router.prototype._getByName = function(name) {\n  var possibleRoutes = _.map(this._routes, function(options, route) {\n    if (_.isArray(options) && options.length > 1) {\n      if ((_.isString(options[1]) && options[1] === name) ||\n          (_.isObject(options[1]) && options.name === name)) {\n        return route;\n      }\n    }\n    return null;\n  });\n\n  var route = _.compact(possibleRoutes);\n  if (route.length > 0) {\n    return route[0];\n  }\n  return false;\n};\n\n// returns a reverse url based on the url name and parameters passed to it.\n// This url won't be validated against the regexp constraints even if available.\n// Neither it will validate if you provided enough parameters, the missing\n// parameters will be displayed as the original url definition.\nMonaco.Router.prototype.reverse = function(name, params) {\n  var url = '';\n  params = params || {};\n  if (!name) {\n    throw new Error('Monaco :: required `name` parameter for `reverse` method');\n  }\n\n  url = this._getByName(name);\n  _.each(params, function(value, key) {\n    url = url.replace(':'+key, value);\n  });\n\n  return url;\n};\n\nreturn Monaco;\n}));\n\n(function(root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define(['lodash', 'backbone', 'storage'], factory);\n  } else if (typeof exports === 'object') {\n    module.exports = factory(require('lodash'), require('backbone'), require('storage'));\n  } else {\n    root.Monaco = factory(root._, root.Backbone, root.localStorage);\n  }\n}(this, function(_, Backbone, localStorage) {\n/*\n * Creates the View monaco class to manage `master` views and `sub-views` of your application\n */\n\n// make sure monaco is defined as the main object\nvar Monaco = this.Monaco = (this.Monaco || {});\n\nvar View = Monaco.View;\nMonaco.View = View.extend({\n  // application namespace\n  namespace : 'views',\n\n  // subviews associated with this view with options to help define\n  // and render each subview\n  views : {},\n\n  // override constructor function\n  constructor : function(options) {\n    options = options || {};\n    // call the original constructor method\n    View.prototype.constructor.apply(this, arguments);\n\n    // assigns a template to the view\n    if (options.template) {\n      this.template = options.template;\n    }\n\n    // children view instances\n    this.children = {};\n\n    // instantiate each available subview\n    _.each(this.views, this._subviewConstructor, this);\n\n    // wrap the render method to work with subviews\n    var render = this.render;\n    this.render = _.bind(function() {\n      // render the master view first\n      render.apply(this, arguments);\n      // then render subviews\n      this._subviewsRender.apply(this, arguments);\n\n      this.trigger('rendered', this);\n      return this;\n    }, this);\n\n    // wrap the remove method to work with subviews\n    var remove = this.remove;\n    this.remove = _.bind(function() {\n      // remove the subviews first\n      this._subviewsRemove.apply(this, arguments);\n      // then remove the master view\n      remove.apply(this, arguments);\n\n      this.trigger('removed', this);\n      return this;\n    }, this);\n  },\n\n  // Default render method that renders the template by appending it to the view's element\n  render : function(data) {\n    // only renders view's that have a template\n    if ( this.template ) {\n      // data will be a mixture of data parameters with either the view's collection or model\n      data = _.extend(data, (this.collection ? this.collection.toJSON() : (this.model ? this.model.toJSON() : {})));\n\n      // render the template using the data, appending the result into the view's element\n      this.$el.append(this.template(data));\n    }\n\n    // return the current view after rendering to allow chainable calls\n    return this;\n  },\n\n  // adds a subview after this view has been instantiated\n  // the parameter view should be on the same format you would include your views in a template\n  add : function(view) {\n    var keys = _.keys(view),\n        selector = keys[0],\n        options = view[selector];\n\n    if (!selector || !options) {\n      throw new Error('Monaco :: Invalid subview parameters');\n    }\n    this._subviewConstructor(options, selector);\n  },\n\n  // creates the necessary subview instance(s), storing their reference\n  _subviewConstructor : function(options, selector) {\n    var ViewClass,\n        params = {};\n\n    options = options || {};\n    // todo: find a way of checking if this is an anonymous function or a View Class that inherits from Monaco.View\n    //       the following line just works with anonymous function that returns a Monaco.View class\n    //       _.result can't be used since we want to specify the context (this keyword)\n    ViewClass = options.viewClass ? options.viewClass.call(this) : Monaco.View;\n\n    // todo: find a way of checking if this is an anonymous function or a Collection Class that inherits from Monaco.Collection\n    //       the following line just works with anonymous function that returns a Monaco.Collection class\n    //       _.result can't be used since we want to specify the context (this keyword)\n    var collection = options.collection ? options.collection.call(this) : this.collection;\n\n    // sets the collection parameter if available\n    if (collection && !options.collectionItem) {\n      params.collection = collection;\n    }\n    // sets the model parameter if available\n    else if (options.model || this.model) {\n      params.model = (options.model || this.model);\n    }\n    // sets the template parameter if available\n    if (options.template) {\n      params.template = options.template;\n    }\n\n    // if collectionItem then creates one subview for each model in the collection\n    if (collection && options.collectionItem) {\n      this._subviewPerModelConstructor(selector, collection, options, params, ViewClass);\n    }\n    // creates only one subview\n    else {\n      var view = new ViewClass(params);\n      view.parent = this;\n      this.children[selector] = view;\n    }\n  },\n\n  // creates one subview per model in the collection, it also sets the master view\n  // to handle events coming from the collection\n  _subviewPerModelConstructor: function(selector, collection, options, params, ViewClass) {\n    // unique namespace per view child to append methods specifically to these views\n    var suffix = this.views[selector].suffix = options.suffix = (options.suffix || _.uniqueId('sfx'));\n    this[suffix] = {};\n\n    // // wrap the generic addOne to inject the itemView and listWrapper properties\n    if (!this[suffix].addOne) {\n      this[suffix].addOne = _.bind(function() {\n        var args = Array.prototype.slice.call(arguments, 0);\n        args.push({itemView: ViewClass, listWrapper: selector, callback: function(view) {\n          view.parent = this;\n          this.children[selector].push(view);\n        }, context: this});\n        return Monaco.ViewForModels.prototype.addOne.apply(this[suffix], args);\n      }, this);\n    }\n\n    // // wrap the generic addAll to inject the itemView and listWrapper properties\n    if (!this[suffix].addAll) {\n      this[suffix].addAll = _.bind(function() {\n          var args = Array.prototype.slice.call(arguments, 0);\n          args.push({itemView: ViewClass, listWrapper: selector, callback: function(view) {\n            view.parent = this;\n            this.children[selector].push(view);\n          }, context: this});\n          return Monaco.ViewForModels.prototype.addAll.apply(this[suffix], args);\n      }, this);\n    }\n\n    // // set the proper events so this view will be listening to the collection events\n    // // and acting accordingly\n    this.listenTo(collection, 'add', _.bind(this[suffix].addOne, this[suffix]));\n    this.listenTo(collection, 'reset', _.bind(this[suffix].addAll, this[suffix]));\n\n    this.children[selector] = [];\n\n    // for each model in the collection creates a new view with the passed parameters\n    collection.each(function(model) {\n      var viewParams = _.clone(params);\n      viewParams.model = model;\n      var view = new ViewClass(viewParams);\n      view.parent = this;\n      this.children[selector].push(view);\n    }, this);\n  },\n\n  // Render each subview after the main view has been rendered. Your can\n  // override this by passing `autoRender: false` as an option for the subview\n  _subviewsRender : function() {\n    var _arguments = arguments;\n    _.each(this.children, function(view, selector) {\n      // have to check since some values of the this.children might be an array\n      // instead of a view instance\n      if (view instanceof Monaco.View) {\n        var options = this.views[selector];\n        // check if the view should be rendered\n        if (!_.has(options, 'autoRender') || options.autoRender === true) {\n\n          // render one view per collection model by using the `addAll` method\n          if (view.collection && options.collectionItem) {\n            // todo: verify if I should create a third argument as I'm doing now to\n            //       include the targets for the viewClass and wrapper of the list\n            //       or if I should include them in the options object parameter instead\n            view[options.suffix].addAll(view.collection, {}, {\n              itemView: options.viewClass ? options.viewClass.call(view) : Monaco.ViewClass,\n              listWrapper: selector\n            });\n          }\n\n          // render a single view\n          else {\n            // render the subview and append its content into the parent view using the\n            // selector associated with the subview\n            // todo: remove jQuery dependency\n            this.$el.find(selector).append(view.render.apply(view, _arguments).el);\n          }\n        }\n      }\n    }, this);\n  },\n\n  // Remove (DOM + Events) each subview before removing the main view\n  _subviewsRemove : function() {\n    var _arguments = arguments;\n    _.each(this.children, function(view, selector) {\n\n      // get original view options\n      var options = this.views[selector];\n\n      // remove each collection's model views\n      if (_.isArray(view)) {\n        // remove each subview from an array of views\n        for(var i = 0, l = view.length; i < l; i++) {\n            view[i].remove.apply(view, _arguments);\n        }\n\n        // removed event listeners\n        // todo: verify if I need to manually unregister the event listeners\n        this.stopListening(this.collection, 'add',  this[options.suffix].addOne);\n        this.stopListening(this.collection, 'reset', this[options.suffix].addAll);\n\n        // remove the suffix namespace\n        delete this[options.suffix];\n      }\n      // remove single view\n      else {\n        view.remove.apply(view, _arguments);\n      }\n    }, this);\n\n    // resetting the this.children to an empty object\n    this.children = {};\n  }\n\n});\n\nMonaco.ViewForModels = Monaco.View.extend({\n  // adds one element to the set of elements by rendering the content of a model\n  addOne : function(model, collection, options, info, fromAddAll) {\n    if ( !(collection instanceof Monaco.Collection) ) {\n      fromAddAll = info;\n      info = options;\n      options = collection;\n      collection = null;\n    }\n    var ViewClass = info.itemView || this.itemView,\n        view = new ViewClass( { model : model } ),\n        content = view.render( model.toJSON() ).el;\n\n    if (info && info.callback) {\n      info.callback.call(info.context || this, view);\n    }\n    if (fromAddAll === true) {\n      return content;\n    }\n    // todo: the following was disabled until I define what to do with jquery as a dependency\n    // $( info.listWrapper || this.listWrapper ).append( content );\n  },\n\n  // adds one element per model based on a collection instance\n  addAll : function(collection, options, info) {\n    var result = [];\n    options = options || {};\n    if ( !options.keepValues ) {\n      // todo: the following was disabled until I define what to do with jquery as a dependency\n      // $( info.listWrapper || this.listWrapper ).html(''); //clear list\n    }\n    collection.each( function( obj ) {\n      result.push(this.addOne( obj, options, info, true ));\n    }, this );\n\n    // todo: the following was disabled until I define what to do with jquery as a dependency\n    // $( info.listWrapper || this.listWrapper ).append(result);\n  }\n});\n\nreturn Monaco;\n}));\n\n(function(root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define(['lodash', 'backbone', 'storage'], factory);\n  } else if (typeof exports === 'object') {\n    module.exports = factory(require('lodash'), require('backbone'), require('storage'));\n  } else {\n    root.Monaco = factory(root._, root.Backbone, root.localStorage);\n  }\n}(this, function(_, Backbone, localStorage) {\n/*\n * Creates a caching layer for Collections and Models, in order to avoid unnecessary\n * requests to the server\n */\n\n// make sure monaco is defined as the main object\nvar Monaco = this.Monaco = (this.Monaco || {});\n\n// Local Cache Application setup\nMonaco.on('app:built', function(app, options) {\n  // set a reference to the application into the local cache\n  app.local._app = app;\n\n  // check the global cacheLocal property for the application\n  if (_.has(options, 'cacheLocal')) {\n    app.local.autoCache = Boolean(_.result(options, 'cacheLocal'));\n  }\n\n  // check the global cacheExpire property for the application\n  if (_.has(options, 'cacheExpire')) {\n    var cacheExpire = _.result(options, 'cacheExpire');\n    app.local.cacheExpire = (_.isNull(cacheExpire) || _.isNumber(cacheExpire)) ? cacheExpire : void 0;\n  }\n\n  // cache any prefetched data for later use on the application\n  if (options.prefetched) {\n    _.each(options.prefetched, function(value, key) {\n      if (!value.data) {\n        return;\n      }\n      this.local.set({resource: key, models:[]}, value.data, value.expire);\n    }, app);\n    delete app.options.prefetched;\n  }\n});\n\n// overrides Monaco.Application add method to check for the required `resources` property\nvar applicationAdd = Monaco.Application.prototype.add;\nMonaco.Application.prototype.add = function(className, Class) {\n  if (Class.prototype.namespace === 'collections' && (!Class.prototype.resource || Class.prototype.resource === '')) {\n    throw new Error('Monaco :: required `resource` property missing from this collection definition');\n  }\n  return applicationAdd.apply(this, arguments);\n};\n\n// Application Local Cache Object\nMonaco.Application.prototype.local = {\n  // by default the application won't auto cache your api calls\n  autoCache : false,\n\n  // default cache expire (in minutes) if you enable local caching\n  cacheExpire : 30,\n\n  // get an object from local cache\n  // return null instead of undefined to comply with the localStorage getItem api\n  get : function( obj ) {\n    var isCollection = _.has(obj, 'models'),\n        collection = isCollection ? obj : (obj.collection || null),\n        resource = collection ? _.result(collection, 'resource') : _.result(obj, 'resource');\n\n    if (resource) {\n      var data = this._getLocalData(resource);\n      if (data) {\n        data.resp = this.decompress(data.resp);\n\n        // get cached model\n        if (!isCollection) {\n          // extract data from model linked with a collection\n          if (collection) {\n            data = _.find(collection.parse(data.resp), function(item) {\n              return item[obj.idAttribute] === obj.id;\n            });\n\n            // only this case needs to retest the expiration, since the expiration tested\n            // in _getLocalData was from the collection, and the model might have its own\n            // expiration rule\n            if (data && (!data._ts || !this._isExpired(data))) {\n              delete data._ts; // remove possible timestamp property\n              return data;\n            }\n          }\n\n          // extract data from model not linked with any collection\n          else if(data.resp[obj.idAttribute] === obj.id) {\n            return data.resp;\n          }\n        }\n        // get cached collection\n        else {\n          return data.resp;\n        }\n      }\n    }\n    return void 0;\n  },\n\n  // set an object in local cache\n  set : function(obj, data, expire) {\n    var isCollection = _.has(obj, 'models'),\n        collection = isCollection ? obj : obj.collection || null,\n        resource = collection ? _.result(collection, 'resource') : _.result(obj, 'resource');\n    expire = (expire !== void 0) ? expire : false;\n\n    if (!resource) {\n      // todo: find a way to log  - 'unable to identify object\\'s resource'\n      return;\n    }\n\n    // caching Model linked with Collection\n    if (!isCollection && collection) {\n      // in case the model has expireLocal set for\n      var modelExpire = expire || _.result(obj, 'expireLocal') ;\n      if (modelExpire) {\n          data = this._setExpire(data, modelExpire, true);\n      }\n      data = this._addToCollectionData(obj, data, collection);\n\n      expire = (expire !== false) ? expire : _.result(collection, 'expireLocal');\n    }\n    // Collections or Models NOT linked with any Collection\n    else {\n      expire = (expire !== false) ? expire : _.result(obj, 'expireLocal');\n    }\n\n    data = this.compress(data);\n    data = this._setExpire(data, expire);\n\n    this._storageSet(resource, data);\n    this._memorySet(resource, data);\n    return true;\n  },\n\n  // clear a specific resource or all resources\n  clear : function(resource) {\n    resource = resource || null;\n    if (!resource) {\n      return this._clearAll();\n    }\n    return this._clearItem(resource);\n  },\n\n  // compress data to be stored - override this with your own data compress implementation\n  compress : function(data) { return data; },\n\n  // decompress data - override this with your own data decompress implementation\n  decompress : function(data) { return data; },\n\n  // get the local data for a collection resource\n  _getLocalData : function(resource) {\n    var localData = null,\n        caching = ['memory', 'storage'];\n\n    for (var i = 0, j = caching.length; i < j; i++) {\n      localData = this['_'+caching[i]+'Get'](resource);\n      if (localData && !this._isExpired(localData)) {\n        if (caching[i] === 'storage') {\n         this._memorySet(resource, localData);\n        }\n        return _.clone(localData);\n      }\n      // todo: add an option on the local caching setup that allows it to control\n      //       the following behaviour\n      // clean up the expired data\n      else if(localData) {\n        this.clear(resource);\n      }\n    }\n\n    return null;\n  },\n\n  // merge the model with the collection data\n  _addToCollectionData : function(model, data, collection) {\n    var restfulData,\n        collectionData = this.get(collection);\n    if (collectionData) {\n      restfulData = collection.parse(collectionData);\n      collection.reset(restfulData, { silent: true });\n    }\n\n    collection.add( data, { silent: true, merge: true } );\n    return collection.revertParse && typeof collection.revertParse === 'function' ? collection.revertParse() : collection.toJSON();\n  },\n\n  // get the resource if it is available in memory\n  // returns the object or if the object is not found it returns\n  // null ( to comply with the localStorage specs)\n  _memoryGet : function(resource) {\n    return this._memory ? this._memory[resource] : null;\n  },\n\n  // set the resource data in memory\n  _memorySet : function(resource, data) {\n    this._memory = this._memory || {};\n    this._memory[resource] = data;\n  },\n\n  // get the resource if it is available in localStorage\n  // returns the object or if the object is not found null\n  _storageGet : function(resource) {\n    var result;\n    try {\n      result = localStorage.getItem(this._getKey(resource));\n    } catch(e) {\n      return null;\n    }\n    return (result === undefined || result === 'undefined' || result === null) ? null : JSON.parse(result);\n  },\n\n  // set the resource data in localStorage\n  _storageSet : function(resource, data) {\n    var key = this._getKey(resource),\n        keys;\n    try {\n      keys = localStorage.getItem('monaco-' + this._app.name + ':keys') || '{}';\n    }\n    catch(e) {\n      return; // fail silently\n    }\n\n    var newKeys = JSON.parse(keys);\n    newKeys[key] = data._ts;\n    try {\n      localStorage.setItem('monaco-' + this._app.name + ':keys', JSON.stringify(newKeys));\n      localStorage.setItem(key, JSON.stringify(data));\n    } catch(e) {\n      // todo: add a warning here\n      try {\n        // resetting the keys to its original value if either the new keys or data failed\n        localStorage.setItem('monaco-' + this._app.name + ':keys', keys);\n      } catch(exception) {\n        // fail silently - todo: add a warning here\n      }\n    }\n  },\n\n  // add the expire timestamp to the data object\n  _setExpire : function(data, expire, asProperty) {\n    var timestamp = null;\n    expire = ( _.isNumber( expire ) || _.isNull( expire ) ) ? expire : void 0;\n    if ( !_.isNull( expire ) ) {\n      var date = new Date();\n      date.setMinutes( date.getMinutes() + ( expire || this.cacheExpire ) );\n      timestamp = date.getTime();\n    }\n    // if asProperty is set to true then append the timestamp to the data\n    // usefull for setting expire for individual methods\n    if (asProperty === true) {\n      data._ts = timestamp;\n      return data;\n    }\n    return {\n      _ts : timestamp,\n      resp : data\n    };\n  },\n\n  // check if the data object is expired\n  _isExpired : function(data) {\n    var expire = data._ts,\n        now = new Date();\n    return ( !_.isNull( expire ) && now.getTime() > expire );\n  },\n\n  // clear a resource item from localStorage and memory\n  _clearItem : function(resource) {\n    var key = this._getKey(resource);\n    // remove the item from local storage\n    try {\n      localStorage.removeItem(key);\n    } catch(e) {\n      throw new Error('Monaco :: unable to remove the localStorage key: ' + key);\n    }\n\n    // remove the item from memory\n    if ( _.has(this._memory, resource) ) {\n      delete this._memory[resource];\n    }\n\n    // clean-up the application keys\n    var keys;\n    try {\n      keys = JSON.parse(localStorage.getItem('monaco-' + this._app.name + ':keys')) || {};\n    } catch(e) {}\n    if (keys) {\n      delete keys[key];\n      return this._app.set('monaco-' + this._app.name + ':keys', keys, true);\n    }\n  },\n\n  // clear all resources associated with this application from localStorage and memory\n  _clearAll : function() {\n    // clean up localStorage\n    var keys = {};\n    try {\n      keys = JSON.parse(localStorage.getItem('monaco-' + this._app.name + ':keys')) || {};\n    } catch(e) {}\n    _.each(keys, function(value, key) {\n      try {\n        var resource = key.split('#');\n        resource = resource[1];\n        localStorage.removeItem(key);\n      } catch(e) {\n        // do nothing\n      }\n    }, this);\n\n    // clean up memory\n    this._memory = {};\n\n    // clean-up the application keys\n    this._app.set('monaco-' + this._app.name + ':keys', {}, true);\n  },\n\n  // get a key based on the resource name and the application\n  _getKey : function(resource) {\n    return this._app.name + '#' + resource;\n  }\n};\n\nvar collectionInitialize = Monaco.Collection.prototype.initialize;\nMonaco.Collection.prototype.initialize = function() {\n  // todo: the `remove` and `add` events are called once per each model what causes\n  //       this method to reset the collection multiple times, if there was a way of\n  //       knowing that a certain event is the last in a series of events fired then\n  //       we could minimize the number of times we reset the collection local cache\n\n  // info: don't need to listen for the `destroy` model event, because it will\n  //       trigger a remove from the collection\n\n  // listen to collection events and updates local caching accordingly\n  this.on('add remove change reset', function() {\n    var options = arguments.length > 0 ? arguments[arguments.length - 1] : {},\n        data;\n\n    // if original call IS NOT a fetch from local storage and this collection\n    // should be cached\n    if (!options.fromLocal &&\n      (_.result(this, 'cacheLocal') === true || this._app.local.autoCache === true)) {\n\n      // ????\n      // this.fetch({localOnly: true, cacheLocal: false, silent: true});\n\n      // make sure the data has the same structure as the original server request\n      data = ( this.revertParse && typeof this.revertParse === 'function' ) ? this.revertParse() : this.toJSON();\n\n      // replace the local data with the new data\n      this._app.local.set(this, data);\n    }\n  }, this);\n  return collectionInitialize.apply(this, arguments);\n};\n\nvar modelInitialize = Monaco.Model.prototype.initialize;\nMonaco.Model.prototype.initialize = function() {\n  // listen to collection events and updates local caching accordingly\n  this.on('change', function() {\n    var options = arguments.length > 0 ? arguments[arguments.length - 1] : {},\n        data;\n\n    // if original call IS NOT a fetch from local storage and this collection\n    // should be cached\n    if (!options.fromLocal &&\n        (_.result(this, 'cacheLocal') === true || (this._app && this._app.local.autoCache === true))) {\n\n      // ????\n      // this.fetch({localOnly: true, cacheLocal: false, silent: true});\n\n      // make sure the data has the same structure as the original server request\n      data = ( this.revertParse && typeof this.revertParse === 'function' ) ? this.revertParse() : this.toJSON();\n\n      // replace the local data with the new data\n      this._app.local.set(this, data);\n    }\n  }, this);\n  return modelInitialize.apply(this, arguments);\n};\n\n/* -- SYNC ------------------------------------------------------------- */\nMonaco.sync = Backbone.sync;\n\n// override the Monaco (Backbone) sync method, so that read calls make\n// usage of the local caching data for Monaco Models or Collections\nBackbone.sync = function(method, model, options) {\n  options = options || {};\n  var app = model._app, // A Monaco Model or Collection will have a reference to the application\n      localOnly = (options.localOnly === true || model.localOnly === true);\n  if (app && method === 'read') {\n    // Attempt to retrieve the data from local cache and if succeed it will call the appropriated success method\n    var data = (options.fresh === true ) ? null : app.local.get(model);\n    if (data) {\n      options.fromLocal = true;\n      if (options.success) {\n        options.success(data);\n      }\n      return true;\n    }\n\n    var isCollection = _.has(model, 'models');\n\n    // call the `error` callback if no data is found and `localOnly` is set to true\n    if (localOnly === true) {\n      if (options.error) {\n        options.error({}, 'Error: resource not found locally', {});\n      }\n      return;\n    }\n    // Check the configuration levels and wrap the success call back if at any level we have cacheLocal defined\n    // If we have a custom cache control key, we want to cache regardless of whether the object wants to cache or not\n    else {\n      var cacheLocal = false,\n          success;\n\n      var customCachePolicy = (isCollection && model.cachePolicy) ? model.cachePolicy :\n                                (!isCollection && model.collection) ? model.collection.cachePolicy :\n                                  (app.options.cachePolicy) ? app.options.cachePolicy : void 0;\n\n      //Determine if we need to do local caching\n\n      //Case 1: Custom Caching Policy supposedly sent by server response\n      cacheLocal = (customCachePolicy && customCachePolicy !== 'local');\n\n      //Case 2: cacheLocal specified to be true at app/collection/model/fetch level\n      if ((_.result(options, 'cacheLocal') === true) || // fetch level\n          (!_.has(options, 'cacheLocal') &&  isCollection && _.result(model, 'cacheLocal') === true) || // collection level\n            (!_.has(options, 'cacheLocal') && (!isCollection && model.collection) && _.result(model.collection, 'cacheLocal') === true) || // model (with collection) level\n              (!_.has(options, 'cacheLocal') && (!isCollection && !model.collection) && _.result(model, 'cacheLocal') === true) || // model (no collection) level\n                  (!_.has(options, 'cacheLocal') && (!_.has(model, 'cacheLocal')) && app.local.autoCache === true)) { // app level\n        cacheLocal = true;\n      }\n\n      if (cacheLocal) {\n        success = options.success;\n        options.success = function(resp, status, xhr) {\n\n          // local caching policy will use the expiration defined or Monaco's default\n          if (!customCachePolicy || customCachePolicy === 'local') {\n            app.local.set(model, resp, _.result(options, 'expireLocal'));\n          }\n\n          // custom caching policy will use the expiration sent by the server\n          // and if not available or too small it won't cache the resource\n          else {\n            var expire = xhr.getResponseHeader(customCachePolicy);\n            if (expire) {\n              // Cache-Control sends expire time in seconds, but Monaco uses minutes\n              expire = parseInt(expire.match(/max-age=([\\d]+)/)[1], 10);\n              if (expire && ((expire / 60) > 0)) {\n                app.local.set(model, resp, (expire / 60));\n              }\n            }\n          }\n\n          if (success) {\n            success.apply(this, arguments);\n          }\n        };\n      }\n    }\n  }\n\n  // return earlier for model/collections or request options set to localOnly\n  if (localOnly === true) {\n    return;\n  }\n  return Monaco.sync(method, model, options);\n};\n\nreturn Monaco;\n}));\n\n(function(root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define(['lodash', 'backbone', 'storage'], factory);\n  } else if (typeof exports === 'object') {\n    module.exports = factory(require('lodash'), require('backbone'), require('storage'));\n  } else {\n    root.Monaco = factory(root._, root.Backbone, root.localStorage);\n  }\n}(this, function(_, Backbone, localStorage) {\n/*\n * Overrides backbone navigation system in order to provide page tracking\n * ps: by default it uses Google Analytics\n *     to integrate it with other platforms check the docs.\n */\n\n// make sure monaco is defined as the main object\nvar Monaco = this.Monaco = (this.Monaco || {});\n\n// keep a reference to the original `loadUrl` method from Monaco\nvar loadUrl = this.Monaco.History.prototype.loadUrl,\n    self = this;\n\n// overridden method to inject a call to track page views\nMonaco.History.prototype.loadUrl = function() {\n  var matched = loadUrl.apply(this, arguments),\n      pvFragment = this.fragment;\n\n  if (!/^\\//.test(pvFragment)) {\n    pvFragment = '/' + pvFragment;\n  }\n  this.trackPageview(pvFragment);\n  return matched;\n};\n\n// Override this method if you are not using google analytics, but\n// instead another analytics service to track page views\nMonaco.History.prototype.trackPageview = function(fragment) {\n  if( self.ga !== void 0 ) {\n    self.ga('send', 'pageview', fragment);\n  }\n};\n\nreturn Monaco;\n}));\n\n(function(root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define(['lodash', 'backbone', 'storage'], factory);\n  } else if (typeof exports === 'object') {\n    module.exports = factory(require('lodash'), require('backbone'), require('storage'));\n  } else {\n    root.Monaco = factory(root._, root.Backbone, root.localStorage);\n  }\n}(this, function(_, Backbone, localStorage) {\n/*\n * Creates the Experiments monaco class, used to work with application experiments\n * ps: by default `Monaco.Experiments` uses Google Analytics to log experiment events\n *     to integrate it with other platforms check the docs.\n */\n\n// make sure monaco is defined as the main object\nvar Monaco = this.Monaco = (this.Monaco || {});\n\n// Transition Application setup\nMonaco.on('app:built', function(app, options) {\n  app.experiments = new Monaco.Experiments(options.experiments);\n});\n\n/* -- MAIN OBJECT ------------------------------------------------------ */\n// Experiments Constructor\nvar Experiments = Monaco.Experiments = function(options) {\n  options = options || {};\n  this._experiments = []; // internal list of experiments\n\n  // merge the default options with the custom options received\n  this.options = _.extend({\n    ga : {slot : 1, scope: 2},\n    cookie : {prefix: 'ab-', days: 360, baseDomain: false }\n  }, options);\n};\n\nExperiments.prototype = _.extend(Experiments.prototype, {\n  // remove the experiment reference from the internal list\n  // _removeReference: function(experiment) {\n  //     var index = this._experiments.indexOf(experiment);\n  //     if (index >= 0) {\n  //         this._experiments.splice(index, 1);\n  //     }\n  // },\n\n  // returns an experiment object based on a key search\n  get: function(key) {\n    return _.find(this._experiments, function(experiment) {\n      return experiment.key === key;\n    });\n  },\n\n  // set an experiment object in the internal list of experiments\n  set: function(key, groups, options) {\n    var experiment = key;\n    if ( !(experiment instanceof Monaco.Experiment) ) {\n      experiment = new Monaco.Experiment(this, key, groups, _.extend(this.options, options));\n    }\n    this._experiments.push(experiment);\n  },\n\n  // remove all split tests\n  // remove: function() {\n  //     _.each(this._experiments, function(experiment) {\n  //         experiment.remove();\n  //     });\n  // },\n\n  // opt-out the current user from all experiments\n  optout: function() {\n    _.each(this._experiments, function(experiment) {\n      experiment.optout();\n    });\n  },\n\n  // split all active experiments\n  split: function() {\n    _.each(this._experiments, function(experiment, index) {\n      experiment.split();\n    });\n  }\n});\n\n/* -- Individual Experiment Object ------------------------------------------- */\nvar Experiment = Monaco.Experiment = function(parent, key, groups, options) {\n  // Every experiment needs a key\n  if ( !key ) {\n    throw new Error('Monaco :: failed to create the experiment: ' + key + ' - experiment key required' );\n  }\n  groups = groups || {};\n  options = options || {};\n  options.users = options.users || 0;\n  // the percentage of users to participate on the experiment should be between 0 and 1\n  if ( !_.isNumber( options.users ) || options.users > 1 || options.users < 0 ) {\n    throw new Error('Monaco :: failed processing experiment: \\'' + key + '\\' - users not defined within allowed range' );\n  }\n  // since the variations will be chosen evenly you can't have more variations than\n  // the percentage number of users participating in the experiment\n  this.usersPerGroup = Math.floor( ( options.users * 100 ) / _.size( groups ) );\n  if ( this.usersPerGroup < 1 ) {\n    throw new Error('Monaco :: failed processing experiment: \\'' + key + '\\' - individual groups set to less than 1%' );\n  }\n  this.parent = parent;\n  this.key = key;\n  this.groups = groups;\n  this.normalized = this._normalizeGroup( groups );\n  // this.cookiePrefix = options.cookie.prefix || 'ab-';\n  this.options = options;\n  this.cookie = {\n    set : Monaco.utils.setCookie,\n    get : Monaco.utils.getCookie\n  };\n};\n\n// normalize groups based on the percentage set for each group\nExperiment.prototype = _.extend(Experiment.prototype, {\n  // original group key used when the user is not assigned to any variation\n  original: '__original__',\n\n  // keep track of the current variation this user is assigned to after splitting this experiment\n  current: null,\n\n  // split this experiment returning the group this user has been set for this experiment\n  split: function() {\n    if (!this.current) {\n      var cookieOpt = this.options.cookie,\n          groupKey = this.cookie.get(cookieOpt.prefix + this.key);\n      if(!groupKey) {\n        groupKey = this.normalized[Math.floor( Math.random() * this.normalized.length )];\n        this.cookie.set(cookieOpt.prefix + this.key, groupKey, cookieOpt.days, cookieOpt.baseDomain);\n        this.saveGroup(groupKey);\n      }\n      // this.current = groupKey === this.original ? groupKey : this.groups[groupKey];\n      this.current = groupKey;\n    }\n\n    return this.current;\n  },\n\n  // return the value of a variation based on its key\n  // if no key is provided and the split was already done\n  // this method will return the value of the chosen group\n  get: function(key) {\n    if (!key && this.current) {\n      return this.groups[this.current];\n    } else if ( !key ) {\n      return void 0;\n    }\n    return this.groups[key];\n  },\n\n  // helper method that will return the name of the controller based on this experiment variation\n  controller: function(methodName) {\n    return !this.current || this.current === this.original ? methodName : methodName + this.get(this.current).suffix;\n  },\n\n  // helper method that will return the class name for the view based on this experiment variation\n  view: function(ViewClass) {\n    return !this.current || this.current === this.original ? ViewClass : ViewClass + this.get(this.current).suffix;\n  },\n\n  // helper method that will return the class name for the template based on this experiment variation\n  template: function(template) {\n    return !this.current || this.current === this.original ? template : template + '.' + this.get(this.current).suffix;\n  },\n\n  // remove this experiment\n  // remove: function() {\n  //     var cookieOpt = this.options.cookie;\n  //     this.current = null;\n  //     this.cookie.set(cookieOpt.prefix + this.key, '', -1, cookieOpt.baseDomain);\n  //     this.parent._removeReference(this);\n  // },\n\n  // optout the current user from a specific experiment, basically setting the cookie\n  // to the `this.original` property value value\n  optout: function() {\n    var cookieOpt = this.options.cookie;\n    this.cookie.set(cookieOpt.prefix + this.key, this.original, cookieOpt.days, cookieOpt.baseDomain);\n  },\n\n  // saves the experiment data, when a user joins one variation of the experiment\n  // override this method if you want to use another service other than Google Analytics\n  saveGroup: function(groupKey) {\n    _gaq.push(['_setCustomVar', this.options.ga.slot, this.key, groupKey, this.options.ga.scope]);\n    _gaq.push(['_trackEvent', 'experiments', 'join', (this.key + '|' + groupKey)]);\n  },\n\n  toJSON: function() {\n    return {\n      current: this.current,\n      group: this.get(),\n      groups: this.groups\n    };\n  },\n\n  // returns an array of 100 items based on the probability of each group\n  _normalizeGroup: function(groups) {\n    var normalized = [],\n        count = 0;\n    for (var groupKey in groups) {\n      if (groups.hasOwnProperty(groupKey)) {\n        for (var i=0, j=this.usersPerGroup; i < j; i++) {\n          normalized.push(groupKey);\n          count++;\n        }\n      }\n    }\n\n    var remaining = 100 - count;\n    while (--remaining >=0) {\n      normalized.push(this.original);\n    }\n    return normalized;\n  }\n});\n\nreturn Monaco;\n}));\n\n(function(root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define(['lodash', 'backbone', 'storage'], factory);\n  } else if (typeof exports === 'object') {\n    module.exports = factory(require('lodash'), require('backbone'), require('storage'));\n  } else {\n    root.Monaco = factory(root._, root.Backbone, root.localStorage);\n  }\n}(this, function(_, Backbone, localStorage) {\n/*\n * Creates the Transition monaco class to help applications ui transition state\n */\n\n// make sure monaco is defined as the main object\nvar Monaco = this.Monaco = (this.Monaco || {});\n\nvar utils = Monaco.utils = Monaco.utils || {};\n\n// Transition Application setup\nMonaco.on('app:built', function(app, options) {\n  app.transitions    = {}; // transition list\n});\n\n// transition from currentView to targetView\nMonaco.Application.prototype.transitionTo = function(targetView, options, Transition) {\n  if (!targetView) {\n    throw new Error('Monaco :: missing target view');\n  }\n\n  var currentView = (this.currentView || null),\n      TransitionClass = Transition || this.transitions.DefaultTransition || Monaco.Transition,\n      transition = new TransitionClass();\n\n  this.currentView = transition.start(currentView, targetView, options);\n};\n\n/* -- TRANSITION ------------------------------------------------------- */\nvar Transition = Monaco.Transition = function(options) {\n  this.initialize.apply(this, arguments);\n};\n\n// extend the Monaco.Transition with Backbone.Events engine\n_.extend(Monaco.Transition.prototype, Backbone.Events, {\n  // application namespace\n  namespace : 'transitions',\n\n  // initialization - Override it with your own logic\n  initialize : function() {},\n\n  // execute the transition - override this method when creating custom transitions\n  // returns the view that will be assigned to the application currentView\n  start : function(fromView, toView, options) {\n    options = options || {};\n    if (fromView && toView.el === fromView.el) {\n      fromView.remove();\n      toView.render(options);\n    }\n    else if (fromView) {\n      toView.render(options);\n      fromView.remove();\n    } else {\n      toView.render(options);\n    }\n    return toView;\n  }\n});\n\nTransition.extend = utils.extend;\n\nreturn Monaco;\n}));\n"],"sourceRoot":"/source/"}